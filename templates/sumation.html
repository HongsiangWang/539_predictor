<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>和數版路</title>

  <!-- DataTables CSS & JS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
</head>
<body>
  <nav style="margin-bottom:0.5rem;">
		<a href="/">主頁</a> |
		<a href="/drag">拖牌</a>|
		<a href="/sumation">和數</a>
  </nav>
  <hr>
  <h2>和數版路分析</h2>
  <h3>最近期號碼: {{latest}}</h3>
  <hr>

  <form method="POST">
    <label>連續期數 (continous):
      <input type="number" name="continous" value="{{ continous }}" min="1" max="10">
    </label>
    <button type="submit">開始預測</button>
  </form>

  {% if results %}
    <h3>固定參數組合結果:</h3>
    <table id="predictionTable" border="1" cellpadding="10" cellspacing="0">
      <thead>
        <tr>
          <th>隔期數</th>
          <th>定位前期數</th>
          <th>版路</th>
          <th>和數</th>
          <th>連續期數(準幾)</th>
          <th>預測號碼</th>
        </tr>
      </thead>
      <tbody>
        {% for r in results %}
          {% if r.predictions %}
            {% for item in r.predictions %}
              {% for comb, pred in zip(item.combination, item.predict) %}
              <tr>
                <td>{{ r.interval }}</td>
                <td>{{ r.position }}</td>
                <td>第{{ comb[0] }}隻 {{ r.version }} 第{{ comb[1] }}隻</td>
                <td>{{ item.add }}</td>
                <td>{{ r.continous }}</td>
                <td class="predict-numbers">{{ pred }}</td>
              </tr>
              {% endfor %}
            {% endfor %}
          {% endif %}
        {% endfor %}
      </tbody>
    </table>

    <script>
      $(document).ready(function() {

        // 自訂排序：將逗號分隔的數字轉成可排序的單一數字
        jQuery.extend(jQuery.fn.dataTable.ext.type.order, {
          "numbers-comma-pre": function (data) {
              let nums = data.split(',').map(x => parseInt(x, 10));
              return nums.reduce((a,b) => a*100 + b, 0); // 合成單一數字
          }
        });

        $('#predictionTable').DataTable({
          "columnDefs": [
            { "type": "numbers-comma", "targets": 5 }  // 預測號碼欄
          ],
          "order": [[5, "asc"]], // 預設按預測號碼排序
          "pageLength": 20
        });

      });
    </script>

  {% endif %}

</body>
</html>
