<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>{{ game }} 拖牌分析</title>
	<style>
		body { font-family: Arial, sans-serif; padding: 1rem; }
		table { border-collapse: collapse; width: 100%; }
		th, td { border: 1px solid #ddd; padding: 6px 8px; text-align: center; }
		th { background:#f2f2f2; }
		section { margin-bottom: 1.5rem; }
	</style>
</head>
<body>
	<div style="margin-bottom:0.5rem;">
		{% if game == '539' %}
		<strong>539</strong> | <a href="/set_game/fantasy5">天天樂</a>
		{% else %}
		<a href="/set_game/539">539</a> | <strong>天天樂</strong>
		{% endif %}
	</div>
	<nav style="margin-bottom:0.5rem;">
		<a href="/">開獎號碼</a> |
		<a href="/drag">拖牌</a>|
		<a href="/sumation">和數</a>
	</nav>
	<hr>
	<h2>{{ game }} 拖牌分析</h2>
	<hr>
    <form method="POST">
		<label for="exclude_last">看前幾期資料:
       		<input type="number" name="exclude_last" value="{{ exclude_last }}" min="0">
		</label>
		&nbsp;
        <label for="period">選擇上幾期做定位牌:
			<input type="number" name="period" value="{{ period }}" min="0">
        </label>
		&nbsp;
		<label for="total_data_num">資料筆數:</label>
		<select id="total_data_num" name="total_data_num">
			{% set cur_total = total_data_num|default('100') %}
			{% for t in [100,200,300,400,500,1000,1500,2000,2500,3000] %}
				<option value="{{ t }}" {% if (t|string) == (cur_total|string) %}selected{% endif %}>{{ t }}</option>
			{% endfor %}
		</select>
        <button type="submit">Apply</button>
    </form>
	<h2>定位牌</h2>
	<p>{{ locator_array }}</p>


    <!-- period selector form -->


	<h2>分析</h2>
	{% if drag_results %}
		{% for r in drag_results %}
			<section>
				<h3>號碼[{{ locator_array[r.idx] }}]拖===></h3>
				<!-- horizontal table showing numbers 1..39 as headers and counts in a single row -->
				<div style="overflow-x:auto;">
					<table style="max-width:1200px; min-width:900px;">
						<thead>
							<tr><th>號碼</th>
								{% for num, cnt in r.sorted_counts %}
									<th>{{ num }}</th>
								{% endfor %}
							</tr>
						</thead>
						<tbody>
							<tr><th>次數</th>
								{% for num, cnt in r.sorted_counts %}
									<td>{{ cnt }}</td>
								{% endfor %}
							</tr>
						</tbody>
					</table>
				</div>
			</section>
		{% endfor %}
	{% else %}
		<p>No drag results to display.</p>
	{% endif %}

</body>
</html>
